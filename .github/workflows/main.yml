name: huskyCI

on:
  push:
    branches:
      - main
  pull_request:
      branches:
        - main

jobs:
  huskyCI:
    runs-on: ubuntu-latest
    environment: HUSKYCI
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Run huskyCI
      
        #env:
         # HUSKY_URL: ${{secrets.HUSKY_URL}}                    
          
      
        run: |
          curl -i -H "Content-Type:application/json" -d '{"repositoryURL":"https://github.com/matholiveira91/hsk.git","repositoryBranch":"main"}' ${{secrets.HUSKY_URL}}
          headers=$(curl -i -H "Content-Type:application/json" -d '{"repositoryURL":"https://github.com/matholiveira91/hsk.git","repositoryBranch":"main"}' ${{secrets.HUSKY_URL}})
          sleep 30s
          request_id=$(echo "$headers" | grep 'X-Request-Id:' | awk '{print $2}')
          combined_url="${{ secrets.HUSKY_URL }}/$request_id"
          response=$(curl -s "$combined_url" 2>&1)
          exit_code=$?
          if [ $exit_code -ne 0 ]; then
              echo "Failed to retrieve the content from $combined_url"
              echo "Error: $response"
          else
              echo "$response"
          fi
